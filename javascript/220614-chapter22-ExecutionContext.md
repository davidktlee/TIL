# TIL 

## 소스코드의 평가와 실행

자바스크립트 엔진은 소스코드를 ‘소스코드의 평가’ 와 ‘소스코드의 실행’ 과정으로 나누어 처리한다.
소스코드 평가 과정에서는 실행 컨텍스트를 생성하고 변수, 함수 등의 선언문만 먼저 실행하여 생성된
 **변수**나 **함수** **식별자**를 **키**로 실행 컨텍스트가 관리하는 스코프(렉시컬 환경의 환경 레코드)에
등록한다. 

**렉시컬 환경이란?**
- 식별자와 식별자의 값, 상위 스코프에 대한 참조를 기록하는 자료구조.
- 스코프와 식별자를 관리한다.

평가가 끝나면 선언문을 제외한 소스코드가 순차적으로 실행되기 시작한다. 즉, 런타임이 시작된다.
이때 실행에 필요한 정보(변수, 함수의 참조)를 실행 컨텍스트가 관리하는 스코프에서 검색, 취득
변수 값의 변경 등 소스코드의 실행 결과는 다시 실행 컨텍스트가 관리하는 스코프에 등록된다.

## 실행 컨텍스트의 역할

식별자와 스코프는 실행 컨텍스트의 렉시컬 환경에서 관리하고 코드 실행 순서는 실행 컨텍스트 스택으로 관리한다.

## 실행 컨텍스트의 생성과 식별자 검색 과정

1. 전역 실행 컨텍스트 생성 후 컨텍스트 스택에 푸쉬. 현재 실행 컨텍스트가 된다.
2. 렉시컬 환경 생성
2-1. 전역 변수를 관리하는 전역 스코프, 전역 객체 제공
2-1-1. 객체 환경 레코드 생성
-> var 전역 변수와 함수 선언문의 전역 함수는 BindingObject를 통해 전역 객체의 프로퍼티와 
메서드가 된다.
2-1-2. 선언적 환경 레코드 생성
-> let, const는 선언적 환경 레코드라는 개념적인 블록 내에 존재하게 된다.
2-2. this 바인딩
-> 전역 환경 레코드의 [[glovalThisValue]] 내부 슬롯에 this가 바인딩 되고,
전역 코드에서 this는 전역 객체를 가리키므로 내부 슬롯에는 전역 객체가 바인딩 된다.
*this 바인딩은 전역 환경 레코드와 함수 환경 레코드에만 존재한다.
2-3. 외부 렉시컬 환경에 대한 참조
-> 외부 소스 코드의 렉시컬 환경, 즉 상위 스코프에 대한 참조를 말한다.

### 함수 코드 실행 될 때

자바스크립트의 함수는 어디에서 정의했는지에 따라서 스코프가 결정되는 렉시컬 스코프이다.

자바스크립트 엔진은 함수 정의를 평가해서 함수 객체를 생성할 때 현재 실행 중인 실행 컨텍스트의 **렉시컬 환경, 즉 함수의 상위 스코프** 를 함수 객체의 내부슬롯 `[[Environment]]` 에 저장한다.

함수 실행 컨텍스트가 제거되었다고 해서 함수의 렉시컬 환경까지 즉시 소멸하는 것은 아니다.

**렉시컬 환경은 실행 컨텍스트에 의해 참조되기는 하지만 독립적인 객체다.**

**실행 컨텍스트가 소멸되어도 누군가 참조하고 있다면 렉시컬 환경은 소멸하지 않는다.**

## 실행 컨텍스트와 블록 레벨 스코프

var와 다르게 let, const는 블록 레벨 스코프를 따르기 때문에 코드 블록이 실행되면 새로운 블록 레벨 스코프가 생성해야된다. 이를 위해 선언전 환경 레코드를 갖는 렉시컬 환경을 새롭게 생성하여 기존의 렉시컬 환경을 교체한다.

이 때 외부 렉시컬 환경에 대한 참조는 코드 블록이 실행되기 이전의 전역 렉시컬 환경을 가리킨다.
